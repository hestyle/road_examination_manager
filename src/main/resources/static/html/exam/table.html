<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>考试信息列表</title>
    <link rel="stylesheet" href="../../layui/css/layui.css">
    <link rel="stylesheet" href="../../css/style.css">
</head>
<body>
    <table id="examTable" lay-filter="examTable"></table>
</body>
</html>

<script src="../../js/jquery.min.js"></script>
<script src="../../layui/layui.all.js"></script>



<script>
    layui.use(['table','form', 'layer'], function() {
        var table = layui.table;
        var form = layui.form;
        layer = layui.layer;

        var examTableIns = table.render({
            elem: '#examTable'
            ,toolbar: '#topBar'
            ,defaultToolbar: ['print', 'exports']
            ,url: '/road_examination_manager/exam/findByPage.do'
            ,method: 'POST'
            ,cols:[[
                {title: '考试信息列表',align: 'center', colspan: 7}
            ],[
                {title: '准考证号', field: 'admissionNo'}
                ,{title: '成绩', field: 'scored'}
                ,{title: '考试开始时间', field: 'examTime'}
                ,{title: '考试结束时间', field: 'completedTime'}
                ,{title: '考试状态', field: 'state'}
                ,{title: '通过状态', field: 'isPass'}
                ,{fixed:'right',width:'20%', unresize:true ,align:'center', toolbar: '#rowBar', title: '操作'}
            ]]
            ,page: true
            ,request: {
                pageName: 'pageIndex' //页码的参数名称，默认：page
                ,limitName: 'pageSize' //每页数据量的参数名，默认：limit
            }
            ,parseData:function(res){
                console.log(res.data);
                for(i in res.data){
                    switch (res.data[i].state) {
                        case 0:
                            res.data[i].state="<b style='color: #FF5722'>未考试</b>";
                            break;
                        case 1:
                            res.data[i].state="<b style='color: #FFB800'>考试中</b>";
                            break;
                        case 2:
                            res.data[i].state="<b style='color: #FFB800'>完成考试</b>";
                            break;
                    }
                    if(res.data[i].scored == null || res.data[i].scored == '' || res.data[i].scored == undefined){
                        res.data[i].scored = "<span style='color: #FF5722'>无成绩</span>"
                    }
                    if(res.data[i].isPass == null || res.data[i].isPass == '' || res.data[i].isPass == undefined){
                        res.data[i].isPass = "<span style='color: #FF5722'>异常</span>"
                    }
                }
                return {
                    "status": res.code,
                    "data" : res.data, //解析数据列表
                    "message": res.message,
                    "count": res.count
                }
            }
            ,response: {
                statusName: 'status' //规定数据状态的字段名称，默认：code
                ,statusCode: 200 //规定成功的状态码，默认：0
                ,msgName: 'message' //规定状态信息的字段名称，默认：msg
                ,countName: 'count' //规定数据总数的字段名称，默认：count
                ,dataName: 'data' //规定数据列表的字段名称，默认：data
            }
            ,done: function(res, curr, count){
                //如果是异步请求数据方式，res即为你接口返回的信息。
                //如果是直接赋值的方式，res即为：{data: [], count: 99} data为当前页数据、count为数据总长度
            }
        });

        //每行的操作相应
        table.on('tool(examTable)', function (obj) {
            var examData = obj.data;
            switch(obj.event) {
                case 'delete':
                    deleteByAdmissionNo(examData.admissionNo);
                    break;
            }
        });

        function deleteByAdmissionNo(admissionNo) {
            layer.confirm('确定删除?', function (index) {
                var url = "/road_examination_manager/exam/deleteByAdmissionNo.do";
                $.ajax({
                    "url": url,
                    "type": "GET",
                    "dataType": "json",
                    "data":{'admissionNo': admissionNo},
                    "success": function (json) {
                        if (json.code == 200) {
                            // 成功
                            layer.open({
                                content: "删除成功!",
                                yes: function (index, layero) {//layero 当前层DOM对象
                                    layer.close(index); //如果设定了yes回调，需进行手工关闭
                                    location.reload();
                                }
                            });
                        } else {
                            // 失败
                            layer.alert(json.message);
                        }
                    },
                    "error": function () {
                        layer.open({
                            content: "您的登录信息已过期!请重新登录!",
                            yes: function (index, layero) {//layero 当前层DOM对象
                                layer.close(index); //如果设定了yes回调，需进行手工关闭
                                parent.location.href = "../../login.html";
                            }
                        });
                    }
                });
                layer.close(index);
            }, function (index) {
                layer.close(index);
            });
        }
    });

</script>

<script type="text/html" id="topBar">

</script>

<script type="text/html" id="rowBar">
    <a class="layui-btn layui-btn-sm" lay-event="detail">详细</a>
    <a class="layui-btn layui-btn-sm layui-btn-danger" lay-event="delete">删除</a>
</script>